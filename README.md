# SQL-Advanced-Module-Task
Опис
Необхідно зібрати дані, які допоможуть аналізувати динаміку створення акаунтів, активність користувачів за листами (відправлення, відкриття, переходи), а також оцінювати поведінку в категоріях, таких як інтервал відправлення, верифікація акаунтів і статус підписки. Дані дозволять порівнювати активність між країнами, визначати ключові ринки, сегментувати користувачів за різними параметрами.
Вимоги до SQL-запиту
Результат запиту повинен містити певний перелік полів групування - тобто категоріальних значень (з якими не проводиться ніяких обчислень). Основні метрики по акаунтам, а також основні метрики по емейлам, повинні розраховуватися в цих розрізах:
date — дата (для акаунтів - дата створення акаунта, для емейлів - дата відправки емейла);
country — країна;
send_interval — інтервал відправлення, встановлений акаунтом;
is_verified — перевірено акаунт чи ні;
is_unsubscribed — підписник відписався чи ні.
Твій запит має розраховувати інформацію (в розрізі перелічених полів) по наступним основним метриках:
account_cnt — кількість створених акаунтів;
sent_msg — кількість відправлених листів;
open_msg — кількість відкритих листів;
visit_msg — кількість переходів по листах;
А також по додатковим метриках (які розраховуються на базі основних метрик):
total_country_account_cnt — загальна кількість створених підписників в цілому по країні;
total_country_sent_cnt — загальна кількість відправлених листів в цілому по країні;
rank_total_country_account_cnt — рейтинг країн за кількістю створених підписників в цілому по країні;
rank_total_country_sent_cnt — рейтинг країн за кількістю відправлених листів в цілому по країні.
Метрики для акаунтів і емейлів потрібно розраховувати окремо, щоб зберегти унікальні розрізи для кожного та уникнути конфліктів через різну логіку використання поля date. Для об’єднання результатів використовуй UNION. У фіналі залиш лише ті записи, де rank_total_country_account_cnt або rank_total_country_sent_cnt менше або дорівнює 10.
Обов'язково використай хоча б одне CTE, винеси туди логічні частини запиту. Для розрахунку рангу використовуй функції-вікна.
Структура набору
Запит повинен виводити такі стовпчики:
date — дата;
country — країна;
send_interval — інтервал відправлення;
is_verified — перевірено акаунт чи ні;
is_unsubscribed — підписник відписався;
account_cnt — кількість створених акаунтів;
sent_msg — кількість відправлених листів;
open_msg — кількість відкритих листів;
visit_msg — кількість переходів по листах;
total_country_account_cnt — загальна кількість створених підписників по країні;
total_country_sent_cnt — загальна кількість відправлених листів по країні;
rank_total_country_account_cnt — рейтинг країн за кількістю створених підписників;
rank_total_country_sent_cnt — рейтинг країн за кількістю відправлених листів.
